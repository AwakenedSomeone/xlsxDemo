webpackJsonp([2],{KBfQ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Wgyd"),a=n("3cXf"),l=n.n(a),s=new(n("+RKF").default),c={name:"OrgTree",inject:["containerId","specialLevelKey","specialLevel"],props:{maxLevel:{type:Number,default:1},data:{type:Array,default:function(){return[]}}},data:function(){return{showData:[],colGap:70,containerWidth:0,editIndex:-1,oldValue:""}},mounted:function(){var e=this;s.$on("editInput",function(t){e.oldValue=t.name,e.editInput(t)}),this.$nextTick(function(){e.containerWidth=document.querySelector("#"+e.containerId).clientWidth})},computed:{getWidth:function(){return this.containerWidth/6-this.colGap},getLabelClass:function(){return function(e){var t="";return e.children&&e.isExpanded&&(t+=" label-after"),e.level>0&&(t+=" label-before"),t}}},watch:{data:{handler:function(e){this.showData=JSON.parse(l()(e))},deep:!0,immediate:!0}},methods:{editInput:function(e){var t=!1,n=JSON.parse(l()(this.showData));n.forEach(function(n){n.id===e.id&&(n.isInput=!0,t=!0)}),t&&this.$set(this,"showData",n)},saveAdd:function(e,t){e.name.trim()?(this.$set(e,"isInput",!1),this.$message("已保存")):this.oldValue?(this.$set(e,"name",this.oldValue),this.$set(e,"isInput",!1)):this.showData.splice(t,1)},rightClick:function(e,t,n){0===t.level||t.isNewAdd||(e.preventDefault(),s.$emit("rightClick",e,this.data[n]))},nodeClick:function(e,t){if(e.level<this.maxLevel-1&&!e.isInput){console.log(this.specialLevel,e.level);var n={id:e.level+1+""+Math.random(),level:e.level+1,isNewAdd:!0,name:-1===this.specialLevel||this.specialLevel-1!==e.level?"+ 新建":"+ "+this.specialLevelKey};void 0===e.children?e.isNewAdd||this.$set(e,"children",[n]):e.children.length&&!e.children[e.children.length-1].isNewAdd&&e.children.push(n)}if(e.isNewAdd&&e.level!==this.specialLevel){var i=!0;if(this.showData.forEach(function(e){e.isInput&&(i=!1)}),i){var a={id:Math.random(),name:"",level:e.level,isInput:!0};this.showData.splice(this.showData.length-1,0,a)}}s.$emit("nodeClick",this.data[t])},changeExpand:function(e,t){this.showData.forEach(function(e,n){n!==t&&e.isExpanded&&(e.isExpanded=!1)}),e.isExpanded=!e.isExpanded,this.$forceUpdate()}}},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"node-contanier"},e._l(e.showData,function(t,i){return n("li",{key:t.id,staticClass:"node-item"},[n("span",{class:["node-label",e.getLabelClass(t),t.isNewAdd?"blue-bg":""],style:{width:e.getWidth+"px"},on:{contextmenu:function(n){e.rightClick(n,t,i)},click:function(n){return e.nodeClick(t,i)}}},[t.isInput?e._e():n("span",{staticClass:"label-text"},[e._v(e._s(t.name))]),e._v(" "),t.isInput?n("el-input",{staticStyle:{margin:"-10px"},attrs:{placeholder:"请输入内容"},on:{blur:function(n){return e.saveAdd(t,i)}},nativeOn:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.saveAdd(t,i)}},model:{value:t.name,callback:function(n){e.$set(t,"name",n)},expression:"item.name"}}):e._e(),e._v(" "),t.children&&t.children.length>0?n("i",{class:["icon-folder",t.isExpanded?"el-icon-remove-outline":"el-icon-circle-plus-outline"],on:{click:function(n){return e.changeExpand(t,i)}}}):e._e()],1),e._v(" "),t.isExpanded?n("div",{class:["node-child",t.children&&t.children.length>0?"left-line":""],style:{left:e.getWidth+70+"px"}},[n("OrgTree",{attrs:{data:t.children,maxLevel:6}})],1):e._e()])}),0)},staticRenderFns:[]};var r={data:function(){return{treeData:[{id:"1",name:"冷轧厂",level:0,children:[{id:"1-1",name:"违章处理",level:1,children:[{id:"1-1-1",level:2,name:"倒班作业长提交",children:[{id:"1-1-1-1",name:"送-作业区安全员",level:3,children:[{id:"1-1-1-1-1",name:"作业区安全员",level:4,children:[{id:"1-1-1-1-1-1",name:"胡某某",level:5}]}]}]},{id:"1-1-2",level:2,name:"作业区安全员提交"}]},{id:"1-2",name:"隐患处理",level:1}]},{id:"2",level:0,name:"炼钢厂"}],heads:[{name:"厂区"},{name:"流程名称"},{name:"节点名称"},{name:"环节名称"},{name:"角色名称"},{name:"用户列表"}],selectObj:null}},provide:{containerId:"org-container",specialLevelKey:"新增",specialLevel:5},mounted:function(){var e=this;s.$on("rightClick",function(t,n){e.pop(t,n)}),s.$on("nodeClick",function(e){e.level})},methods:{edit:function(){s.$emit("editInput",this.selectObj)},pop:function(e,t){var n=this;this.selectObj=t,this.$nextTick(function(){n.$refs.contextMenu.open(e)})}},components:{OrgTree:n("C7Lr")(c,d,!1,function(e){n("Q2Iq")},"data-v-78f1e2ef",null).exports,ContextMenu:i.a}},o={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container",attrs:{id:"org-container"}},[n("div",{staticClass:"head"},e._l(e.heads,function(t,i){return n("span",{key:i},[e._v("\n      "+e._s(t.name)+"\n    ")])}),0),e._v(" "),n("OrgTree",{attrs:{data:e.treeData,maxLevel:6}}),e._v(" "),n("ContextMenu",{ref:"contextMenu"},[n("li",{staticClass:"menu_item",on:{click:e.edit}},[e._v("编辑")]),e._v(" "),n("li",{staticClass:"menu_item"},[e._v("删除")])])],1)},staticRenderFns:[]};var u=n("C7Lr")(r,o,!1,function(e){n("LVeE")},"data-v-61aa1d90",null);t.default=u.exports},LVeE:function(e,t){},Q2Iq:function(e,t){}});
//# sourceMappingURL=2.7395aaf7be63aef4a3c9.js.map